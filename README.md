# Beauty Tok

一个基于 PyQt6 的现代化短视频播放器，专注于手机竖屏（9:16）视频的在线播放与本地下载。内置静默预取机制，自动缓存后续视频，提供上一个/下一个、自动连播、下载等功能。

![](/static/screenShot.png)

## 功能特性

- 竖屏视频播放：9:16 手机长条布局，界面简洁现代
- 自动播放与自动连播：
  - 未开启自动连播时，单个视频循环播放
  - 开启自动连播时，播完自动切到下一个
- 上一个/下一个：基于缓存的前进/后退，避免重复请求
- 静默预取：后台自动缓存后面 10 个视频，切换无感知
- 失败自动跳过：404/播放错误时自动切到下一个
- 后台下载：多线程下载，带进度条

## 环境要求

- Python 3.10+（推荐 3.10/3.11）
- Windows 10/11（已在 Win11 测试）

## 安装

```bash
pip install -r requirements.txt
```

requirements.txt 默认包含：
- requests
- PyQt6, PyQt6-Qt6, PyQt6-sip

若 Qt 多媒体播放异常（无声/无法解码），请安装系统级解码器或确保 Qt 自带 FFmpeg 组件可用。

## 运行

```bash
python run.py
```

首次运行会自动启动后台预取，静默缓存后续视频。

## 打包（可选）

已提供示例 `BeautyTok.spec`。你也可以直接使用 PyInstaller：

```bash
pyinstaller --noconfirm --clean --name BeautyTok \
  --icon icon.ico \
  --add-data "src;src" \
  run.py
```

生成的可执行文件位于 `dist/BeautyTok/`。

## 使用说明

- 播放/暂停：中间按钮
- 下一个：优先使用已缓存的视频；若无则获取新视频
- 上一个：回到历史播放的视频
- 自动播放：开启后当前视频结束自动切到下一个
- 刷新：清空缓存并重新开始（用于换一批视频）
- 下载：保存当前视频到本地（支持 mp4/avi/mov）

## 键盘快捷键（若系统焦点在窗口内）

- 空格：播放/暂停
- 左/右：上一个/下一个
- Esc：退出（窗口系统默认）

## 项目结构

```
beauty_tok/
├─ run.py            # 启动脚本
├─ requirements.txt  # 依赖
├─ README.md         # 文档
├─ src/
│  ├─ api.py         # 接口与缓存、预取逻辑
│  └─ view.py        # Qt6 播放器 UI 与业务逻辑
└─ BeautyTok.spec    # 打包配置（可选）
```

## 预取机制说明

- api.py 中内置后台预取线程：
  - 目标保持“当前位置之后”至少 10 个视频缓存
  - 失败自动重试并节流，不影响前台播放
- view.py 在启动时会调用 `start_prefetch(10)` 开启预取
- 如需修改预取数量：

```python
from api import start_prefetch
start_prefetch(20)  # 例如改为预取 20 个
```

## 故障排查

- 无法播放/卡在加载：确保网络可用，检查终端错误输出
- 报错 `404 Not Found`：程序会自动跳到下一个；若连续失败，点击“刷新”换一批
- 无声或格式不支持：Qt 多媒体依赖 FFmpeg，建议更新到最新 PyQt6 或安装系统解码器
- 弹窗黑底黑字：已统一深色样式，若仍异常请检查系统主题/对比度设置

## 许可证

本项目仅用于学习与交流，视频来源由第三方接口提供，请合理合法使用。